{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect,useCallback,useMemo}from'react';import{useLocalStorage}from'../hooks/useLocalStorage';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export{AuthContext};export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser,removeUser]=useLocalStorage('user',null);const[token,setToken,removeToken]=useLocalStorage('token',null);const[loading,setLoading]=useState(true);// Memoized user state to prevent unnecessary re-renders\nconst userState=useMemo(()=>({user,isAuthenticated:!!user&&!!token,role:(user===null||user===void 0?void 0:user.role)||null,permissions:(user===null||user===void 0?void 0:user.permissions)||[]}),[user,token]);useEffect(()=>{const initializeAuth=async()=>{try{setLoading(true);// Validate token if exists\nif(token&&user){try{// You can add token validation logic here\n// const isValid = await validateToken(token);\n// if (!isValid) {\n//   removeUser();\n//   removeToken();\n// }\n}catch(error){console.error('Token validation failed:',error);removeUser();removeToken();}}}catch(error){console.error('Auth initialization error:',error);removeUser();removeToken();}finally{setLoading(false);}};initializeAuth();},[token,user,removeUser,removeToken]);const login=useCallback((userData,authToken)=>{try{setUser(userData);setToken(authToken);}catch(error){console.error('Login error:',error);throw error;}},[setUser,setToken]);const logout=useCallback(()=>{try{removeUser();removeToken();// Clear any other auth-related data\nlocalStorage.removeItem('refreshToken');sessionStorage.clear();}catch(error){console.error('Logout error:',error);}},[removeUser,removeToken]);const updateUser=useCallback(updates=>{try{setUser(prevUser=>({...prevUser,...updates}));}catch(error){console.error('Update user error:',error);throw error;}},[setUser]);const value=useMemo(()=>({...userState,login,logout,updateUser,loading}),[userState,login,logout,updateUser,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useCallback","useMemo","useLocalStorage","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","removeUser","token","setToken","removeToken","loading","setLoading","userState","isAuthenticated","role","permissions","initializeAuth","error","console","login","userData","authToken","logout","localStorage","removeItem","sessionStorage","clear","updateUser","updates","prevUser","value","Provider"],"sources":["D:/Fronted-dev/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { useLocalStorage } from '../hooks/useLocalStorage';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport { AuthContext };\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser, removeUser] = useLocalStorage('user', null);\r\n  const [token, setToken, removeToken] = useLocalStorage('token', null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Memoized user state to prevent unnecessary re-renders\r\n  const userState = useMemo(() => ({\r\n    user,\r\n    isAuthenticated: !!user && !!token,\r\n    role: user?.role || null,\r\n    permissions: user?.permissions || []\r\n  }), [user, token]);\r\n\r\n  useEffect(() => {\r\n    const initializeAuth = async () => {\r\n      try {\r\n        setLoading(true);\r\n        \r\n        // Validate token if exists\r\n        if (token && user) {\r\n          try {\r\n            // You can add token validation logic here\r\n            // const isValid = await validateToken(token);\r\n            // if (!isValid) {\r\n            //   removeUser();\r\n            //   removeToken();\r\n            // }\r\n          } catch (error) {\r\n            console.error('Token validation failed:', error);\r\n            removeUser();\r\n            removeToken();\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Auth initialization error:', error);\r\n        removeUser();\r\n        removeToken();\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    initializeAuth();\r\n  }, [token, user, removeUser, removeToken]);\r\n\r\n  const login = useCallback((userData, authToken) => {\r\n    try {\r\n      setUser(userData);\r\n      setToken(authToken);\r\n    } catch (error) {\r\n      console.error('Login error:', error);\r\n      throw error;\r\n    }\r\n  }, [setUser, setToken]);\r\n\r\n  const logout = useCallback(() => {\r\n    try {\r\n      removeUser();\r\n      removeToken();\r\n      // Clear any other auth-related data\r\n      localStorage.removeItem('refreshToken');\r\n      sessionStorage.clear();\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n    }\r\n  }, [removeUser, removeToken]);\r\n\r\n  const updateUser = useCallback((updates) => {\r\n    try {\r\n      setUser(prevUser => ({\r\n        ...prevUser,\r\n        ...updates\r\n      }));\r\n    } catch (error) {\r\n      console.error('Update user error:', error);\r\n      throw error;\r\n    }\r\n  }, [setUser]);\r\n\r\n  const value = useMemo(() => ({\r\n    ...userState,\r\n    login,\r\n    logout,\r\n    updateUser,\r\n    loading\r\n  }), [userState, login, logout, updateUser, loading]);\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}