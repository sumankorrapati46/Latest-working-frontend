"use strict";(self.webpackChunkagristack_farmer_management=self.webpackChunkagristack_farmer_management||[]).push([[442],{476:(a,e,s)=>{s.d(e,{Ay:()=>g,Dv:()=>n,Er:()=>o,JL:()=>l,R2:()=>r,kM:()=>c,s2:()=>d,xs:()=>i});const t=s(6213).A.create({baseURL:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_URL||"http://localhost:8080/api",timeout:1e4,headers:{"Content-Type":"application/json"}});t.interceptors.request.use((a=>{const e=localStorage.getItem("token");return e&&(a.headers.Authorization=`Bearer ${e}`),a}),(a=>Promise.reject(a))),t.interceptors.response.use((a=>a),(a=>{var e;return 401===(null===(e=a.response)||void 0===e?void 0:e.status)&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(a)}));const r={login:async a=>(await t.post("/auth/login",a)).data,getProfile:async()=>(await t.get("/auth/profile")).data,register:async a=>(await t.post("/auth/register",a)).data,sendOTP:async a=>(await t.post("/auth/send-otp",{emailOrPhone:a})).data,verifyOTP:async a=>(await t.post("/auth/verify-otp",{emailOrPhone:a.email,otp:a.otp})).data,resendOTP:async a=>(await t.post("/auth/resend-otp",{emailOrPhone:a})).data,forgotPassword:async a=>(await t.post("/auth/forgot-password",{emailOrPhone:a})).data,forgotUserId:async a=>(await t.post("/auth/forgot-user-id",{emailOrPhone:a})).data,resetPassword:async a=>(await t.post("/auth/reset-password",a)).data,changePassword:async a=>(await t.post("/auth/change-password",a)).data,changeUserId:async a=>(await t.post("/auth/change-user-id",a)).data,getCountries:async()=>(await t.get("/auth/countries")).data,getStates:async a=>(await t.post("/auth/states",{countryId:a})).data},n={getAllUsers:async()=>(await t.get("/super-admin/registration-list")).data,getRegistrationList:async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await t.get("/super-admin/registration-list",{params:a})).data},getRegistrationListByStatus:async a=>(await t.get("/super-admin/registration-list/filter",{params:{status:a}})).data,searchRegistrations:async a=>(await t.get("/super-admin/registration-list/search",{params:{query:a}})).data,getPendingRegistrations:async()=>(await t.get("/super-admin/pending-registrations")).data,getApprovedUsers:async()=>(await t.get("/super-admin/approved-users")).data,getUsersByRole:async a=>(await t.get(`/super-admin/users/by-role/${a}`)).data,getPendingUsersByRole:async a=>(await t.get(`/super-admin/pending-users/by-role/${a}`)).data,approveUser:async(a,e)=>(await t.put(`/auth/users/${a}/approve`,{role:e})).data,rejectUser:async(a,e)=>(await t.put(`/auth/users/${a}/status`,{status:"REJECTED"})).data,deleteUser:async a=>(await t.delete(`/super-admin/users/${a}`)).data,updateUser:async(a,e)=>(await t.put(`/super-admin/users/${a}`,e)).data,updateUserStatus:async(a,e)=>(await t.put(`/auth/users/${a}/status`,{status:e})).data,getDashboardStats:async()=>(await t.get("/super-admin/dashboard/stats")).data,bulkAssignFarmers:async(a,e)=>(await t.post("/super-admin/bulk-assign-farmers",{farmerIds:a,employeeId:e})).data,assignFarmer:async(a,e)=>(await t.post("/super-admin/assign-farmer",null,{params:{farmerId:a,employeeId:e}})).data},i={getAllFarmers:async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await t.get("/super-admin/farmers",{params:a})).data},getFarmerById:async a=>(await t.get(`/super-admin/farmers/${a}`)).data,createFarmer:async a=>(await t.post("/super-admin/farmers",a)).data,updateFarmer:async(a,e)=>(await t.put(`/super-admin/farmers/${a}`,e)).data,deleteFarmer:async a=>(await t.delete(`/super-admin/farmers/${a}`)).data,assignFarmer:async(a,e)=>(await t.post(`/super-admin/farmers/${a}/assign`,{employeeId:e})).data,getFarmerStats:async()=>(await t.get("/super-admin/farmers/stats")).data},o={getAllFarmers:async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await t.get("/admin/farmers",{params:a})).data},getAllEmployees:async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await t.get("/admin/employees",{params:a})).data},getFarmersWithKyc:async()=>(await t.get("/admin/farmers-with-kyc")).data,getEmployeesWithStats:async()=>(await t.get("/admin/employees-with-stats")).data,getFarmersByEmployee:async a=>(await t.get(`/admin/employees/${a}/assigned-farmers`)).data,getTodoList:async()=>(await t.get("/admin/todo-list")).data,getEnhancedTodoList:async()=>(await t.get("/admin/enhanced-todo-list")).data,getDashboardStats:async()=>(await t.get("/admin/dashboard-stats")).data,filterFarmers:async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await t.get("/admin/farmers/filter",{params:a})).data},getLocations:async()=>(await t.get("/admin/locations")).data,bulkAssignFarmers:async(a,e)=>(await t.post("/admin/bulk-assign-farmers",{farmerIds:a,employeeId:e})).data,assignFarmer:async(a,e)=>(await t.post("/admin/assign-farmer",null,{params:{farmerId:a,employeeId:e}})).data,getAssignmentHistory:async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await t.get("/admin/assignment-history",{params:a})).data},getFarmersByAssignmentStatus:async a=>(await t.get("/admin/farmers/by-assignment-status",{params:{assignmentStatus:a}})).data,getAllRegistrations:async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await t.get("/admin/registration-list",{params:a})).data},getRegistrationListByStatus:async a=>(await t.get("/admin/registration-list/filter",{params:{status:a}})).data,approveRegistration:async(a,e)=>(await t.post(`/admin/registrations/${a}/approve`,e)).data,rejectRegistration:async(a,e)=>(await t.post(`/admin/registrations/${a}/reject`,e)).data},d={getAllEmployees:async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await t.get("/super-admin/employees",{params:a})).data},getEmployeeById:async a=>(await t.get(`/super-admin/employees/${a}`)).data,createEmployee:async a=>(await t.post("/super-admin/employees",a)).data,updateEmployee:async(a,e)=>(await t.put(`/super-admin/employees/${a}`,e)).data,deleteEmployee:async a=>(await t.delete(`/super-admin/employees/${a}`)).data,getAssignedFarmers:async a=>(await t.get(`/super-admin/employees/${a}/assigned-farmers`)).data,getEmployeeStats:async()=>(await t.get("/super-admin/employees/stats")).data},l={getAssignedFarmers:async a=>{try{console.log("\ud83d\udd04 Fetching assigned farmers from dashboard endpoint");const a=await t.get("/employees/dashboard/assigned-farmers");return console.log("\u2705 Success with dashboard endpoint"),a.data}catch(e){throw console.error("\u274c Failed to fetch assigned farmers:",e),e}},getProfile:async()=>(await t.get("/employees/profile")).data,updateProfile:async a=>(await t.put("/employees/profile",a)).data,getStats:async()=>(await t.get("/employees/stats")).data},c={uploadDocuments:async(a,e)=>{const s=new FormData;Object.keys(e).forEach((a=>{e[a]&&s.append(a,e[a])}));return(await t.post(`/employees/kyc/${a}/upload`,s,{headers:{"Content-Type":"multipart/form-data"}})).data},approveKYC:async(a,e)=>(await t.put(`/employees/kyc/approve/${a}`)).data,rejectKYC:async(a,e)=>(await t.put(`/employees/kyc/reject/${a}`,{reason:e.reason||"KYC rejected"})).data,referBackKYC:async(a,e)=>(await t.put(`/employees/kyc/refer-back/${a}`,{reason:e.reason||"KYC referred back"})).data,getKYCStatus:async a=>(await t.get(`/employees/kyc/${a}/status`)).data,getKYCDocuments:async a=>(await t.get(`/employees/kyc/${a}/documents`)).data},g=t},2442:(a,e,s)=>{s.r(e),s.d(e,{default:()=>l});var t=s(5043),r=s(3216),n=s(5016),i=s(476),o=s(4513),d=(s(4003),s(579));const l=()=>{const{user:a,login:e}=(0,t.useContext)(n.cy),s=(0,r.Zp)(),[l,c]=(0,t.useState)({newPassword:"",confirmPassword:""}),[g,p]=(0,t.useState)(""),[m,u]=(0,t.useState)(""),h=a=>{c({...l,[a.target.name]:a.target.value})};return a?(0,d.jsxs)("div",{className:"login-page-container",children:[(0,d.jsxs)("div",{className:"login-page-main-content",children:[(0,d.jsxs)("div",{className:"login-page-info-panel",children:[(0,d.jsxs)("div",{className:"login-page-brand-header",children:[(0,d.jsxs)("div",{className:"login-page-brand-logo",children:[(0,d.jsx)("span",{className:"login-page-brand-text",children:"Date"}),(0,d.jsx)("span",{className:"login-page-brand-accent",children:"Agri"}),(0,d.jsx)("span",{className:"login-page-brand-icon",children:"\ud83c\udf3f"}),(0,d.jsx)("span",{className:"login-page-brand-text",children:"Stack"})]}),(0,d.jsx)("h1",{className:"login-page-main-title",children:"India Farmer Registry"})]}),(0,d.jsxs)("div",{className:"login-page-platform-info",children:[(0,d.jsx)("h2",{children:"Password Security"}),(0,d.jsx)("p",{className:"login-page-tagline",children:"Keep your account safe with a strong password"})]}),(0,d.jsxs)("div",{className:"login-page-features-grid",children:[(0,d.jsxs)("div",{className:"login-page-feature-card",children:[(0,d.jsx)("div",{className:"login-page-feature-icon",children:"\ud83d\udd10"}),(0,d.jsxs)("div",{className:"login-page-feature-content",children:[(0,d.jsx)("h3",{children:"Strong Password"}),(0,d.jsx)("p",{children:"Create a secure password with our guidelines"})]})]}),(0,d.jsxs)("div",{className:"login-page-feature-card",children:[(0,d.jsx)("div",{className:"login-page-feature-icon",children:"\ud83d\udee1\ufe0f"}),(0,d.jsxs)("div",{className:"login-page-feature-content",children:[(0,d.jsx)("h3",{children:"Account Protection"}),(0,d.jsx)("p",{children:"Enhanced security for your personal data"})]})]}),(0,d.jsxs)("div",{className:"login-page-feature-card",children:[(0,d.jsx)("div",{className:"login-page-feature-icon",children:"\u26a1"}),(0,d.jsxs)("div",{className:"login-page-feature-content",children:[(0,d.jsx)("h3",{children:"Quick Update"}),(0,d.jsx)("p",{children:"Change your password in just a few steps"})]})]}),(0,d.jsxs)("div",{className:"login-page-feature-card",children:[(0,d.jsx)("div",{className:"login-page-feature-icon",children:"\ud83d\udd12"}),(0,d.jsxs)("div",{className:"login-page-feature-content",children:[(0,d.jsx)("h3",{children:"Secure Process"}),(0,d.jsx)("p",{children:"Your password is encrypted and protected"})]})]}),(0,d.jsxs)("div",{className:"login-page-feature-card",children:[(0,d.jsx)("div",{className:"login-page-feature-icon",children:"\u2705"}),(0,d.jsxs)("div",{className:"login-page-feature-content",children:[(0,d.jsx)("h3",{children:"Instant Access"}),(0,d.jsx)("p",{children:"Access your account immediately after update"})]})]})]})]}),(0,d.jsx)("div",{className:"login-page-form-section",children:(0,d.jsxs)("div",{className:"login-page-card",children:[(0,d.jsxs)("div",{className:"login-page-date-logo-section",children:[(0,d.jsx)("img",{src:o,alt:"DATE Logo",className:"login-page-date-logo"}),(0,d.jsxs)("div",{className:"login-page-date-text",children:[(0,d.jsx)("h3",{children:"Digital Agristack Transaction Enterprises"}),(0,d.jsx)("p",{children:"Empowering Agricultural Excellence"})]})]}),(0,d.jsxs)("div",{className:"login-page-login-type-section",children:[(0,d.jsx)("h3",{children:"Change Password"}),(0,d.jsx)("p",{children:"Enter your new password to continue"})]}),(0,d.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),p(""),u(""),l.newPassword!==l.confirmPassword)return void p("New password and confirm password do not match.");if(l.newPassword.length<6)return void p("New password must be at least 6 characters long.");const r=/[A-Z]/.test(l.newPassword),n=/\d/.test(l.newPassword),o=/@/.test(l.newPassword);if(r&&n&&o)try{console.log("Attempting to change password for user:",(null===a||void 0===a?void 0:a.email)||(null===a||void 0===a?void 0:a.userName));const t=await i.Ay.post("/auth/reset-password/confirm",{emailOrPhone:(null===a||void 0===a?void 0:a.email)||(null===a||void 0===a?void 0:a.userName),newPassword:l.newPassword,confirmPassword:l.confirmPassword});console.log("Password change response:",t.data),u("Password changed successfully! Redirecting to dashboard...");const r={...a,forcePasswordChange:!1};localStorage.setItem("user",JSON.stringify(r)),e(r,localStorage.getItem("token")),setTimeout((()=>{"SUPER_ADMIN"===a.role?s("/super-admin/dashboard"):"ADMIN"===a.role?s("/admin/dashboard"):"EMPLOYEE"===a.role?s("/employee/dashboard"):s("/dashboard")}),1500)}catch(j){var d,c,g,m,h,y,w,f,v,x;if(console.error("Password change error:",j),console.error("Error response:",null===(d=j.response)||void 0===d?void 0:d.data),console.error("Error status:",null===(c=j.response)||void 0===c?void 0:c.status),400===(null===(g=j.response)||void 0===g?void 0:g.status))p((null===(v=j.response)||void 0===v||null===(x=v.data)||void 0===x?void 0:x.message)||"Invalid password format. Please check the requirements.");else 401===(null===(m=j.response)||void 0===m?void 0:m.status)?p("Session expired. Please log in again."):404===(null===(h=j.response)||void 0===h?void 0:h.status)?p("User not found. Please contact administrator."):500===(null===(y=j.response)||void 0===y?void 0:y.status)?p("Server error. Please try again later."):null!==(w=j.response)&&void 0!==w&&null!==(f=w.data)&&void 0!==f&&f.message?p(j.response.data.message):p("Failed to change password. Please try again.")}else p("Password must include an uppercase letter, a number, and an @ symbol.")},className:"login-page-form",children:[(0,d.jsxs)("div",{className:"login-page-form-field",children:[(0,d.jsxs)("label",{children:["New Password ",(0,d.jsx)("span",{className:"required",children:"*"})]}),(0,d.jsx)("input",{type:"password",name:"newPassword",value:l.newPassword,onChange:h,required:!0,placeholder:"Enter your new password",disabled:!!m,className:"login-page-form-input"}),(0,d.jsx)("div",{style:{fontSize:13,color:"#888",marginTop:4},children:"Password must be at least 6 characters, include an uppercase letter, a number, and an @ symbol."})]}),(0,d.jsxs)("div",{className:"login-page-form-field",children:[(0,d.jsxs)("label",{children:["Confirm New Password ",(0,d.jsx)("span",{className:"required",children:"*"})]}),(0,d.jsx)("input",{type:"password",name:"confirmPassword",value:l.confirmPassword,onChange:h,required:!0,placeholder:"Confirm your new password",disabled:!!m,className:"login-page-form-input"})]}),g&&(0,d.jsx)("div",{className:"error-message",children:g}),m&&(0,d.jsx)("div",{className:"verification-success",children:m}),(0,d.jsx)("div",{className:"login-page-actions-row",children:(0,d.jsx)("button",{type:"submit",className:"login-page-login-btn",disabled:!!m,children:"Change Password"})})]})]})})]}),m&&(0,d.jsx)("div",{style:{position:"fixed",left:0,top:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.25)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:(0,d.jsxs)("div",{style:{background:"#fff",borderRadius:10,padding:32,minWidth:320,boxShadow:"0 2px 16px #0002",textAlign:"center"},children:[(0,d.jsx)("h2",{style:{color:"#22c55e",marginBottom:12},children:"Password Changed!"}),(0,d.jsxs)("p",{style:{color:"#333",marginBottom:18},children:["Your password has been updated successfully.",(0,d.jsx)("br",{}),"Redirecting to your dashboard..."]})]})})]}):(s("/login"),null)}},4003:()=>{},4513:(a,e,s)=>{a.exports=s.p+"static/media/rightlogo.1742b4514aa334820279.png"}}]);
//# sourceMappingURL=442.0dee439c.chunk.js.map